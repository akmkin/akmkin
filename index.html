<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Card</title>
	</head>
	<body>
	<script src="https://vk.com/js/api/xd_connection.js?2"  type="text/javascript"></script>
	<script src="/js/jquery.js"></script>
	<script src="/js/jcanvas.js"></script>

	<script type="text/javascript"> 
		window.name = 'fXD';
		var ststus = false;
		$(document).ready(function(){  VK.init(function() { 
		     console.log('OK');
		     status = true;
		  }, function() { 
		     console.log('Err');
		}, '5.69')}); 
	</script>
	<!-- <div align="center"> -->
		<canvas id='card' height='600' width='800' style="border:1px solid black;background:#000;">Обновите браузер</canvas>
	<!-- </div> -->
	<script src="/js/jquery.js"></script>
	<script src="/js/jcanvas.js"></script>
	<script>

		kol = [
			//Image, adress, match, mast, number, x, y, on_field
			[new Image(),	'1p.png', 		1,		1, 		1,		0,		0,		0],
			[new Image(),	'2p.png', 		2,		1, 		2,		0,		0,		0],
			[new Image(),	'3p.png', 		3,		1, 		3,		0,		0,		0],
			[new Image(),	'4p.png', 		4,		1, 		4,		0,		0,		0],
			[new Image(),	'5p.png', 		5,		1, 		5,		0,		0,		0],
			[new Image(),	'6p.png', 		6,		1, 		6,		0,		0,		0],
			[new Image(),	'7p.png', 		7,		1, 		7,		0,		0,		0],
			[new Image(),	'8p.png', 		8,		1, 		8,		0,		0,		0],
			[new Image(),	'9p.png', 		9,		1, 		9,		0,		0,		0],
			[new Image(),	'10p.png', 		10,		1, 		10,		0,		0,		0],
			[new Image(),	'11p.png', 		11,		1, 		11,		0,		0,		0],
			[new Image(),	'12p.png', 		12,		1, 		12,		0,		0,		0],
			[new Image(),	'13p.png', 		13,		1, 		13,		0,		0,		0],
			[new Image(),	'1t.png', 		1,		2, 		14,		0,		0,		0],
			[new Image(),	'2t.png', 		2,		2, 		15,		0,		0,		0],
			[new Image(),	'3t.png', 		3,		2, 		16,		0,		0,		0],
			[new Image(),	'4t.png', 		4,		2, 		17,		0,		0,		0],
			[new Image(),	'5t.png', 		5,		2, 		18,		0,		0,		0],
			[new Image(),	'6t.png', 		6,		2, 		19,		0,		0,		0],
			[new Image(),	'7t.png', 		7,		2, 		20,		0,		0,		0],
			[new Image(),	'8t.png', 		8,		2, 		21,		0,		0,		0],
			[new Image(),	'9t.png', 		9,		2, 		22,		0,		0,		0],
			[new Image(),	'10t.png', 		10,		2, 		23,		0,		0,		0],
			[new Image(),	'11t.png', 		11,		2, 		24,		0,		0,		0],
			[new Image(),	'12t.png', 		12,		2, 		25,		0,		0,		0],
			[new Image(),	'13t.png', 		13,		2, 		26,		0,		0,		0],
			[new Image(),	'1b.png', 		1,		3, 		27,		0,		0,		0],
			[new Image(),	'2b.png', 		2,		3, 		28,		0,		0,		0],
			[new Image(),	'3b.png', 		3,		3, 		29,		0,		0,		0],
			[new Image(),	'4b.png', 		4,		3, 		30,		0,		0,		0],
			[new Image(),	'5b.png', 		5,		3, 		31,		0,		0,		0],
			[new Image(),	'6b.png', 		6,		3, 		32,		0,		0,		0],
			[new Image(),	'7b.png', 		7,		3, 		33,		0,		0,		0],
			[new Image(),	'8b.png', 		8,		3, 		34,		0,		0,		0],
			[new Image(),	'9b.png', 		9,		3, 		35,		0,		0,		0],
			[new Image(),	'10b.png', 		10,		3, 		36,		0,		0,		0],
			[new Image(),	'11b.png', 		11,		3, 		37,		0,		0,		0],
			[new Image(),	'12b.png', 		12,		3, 		38,		0,		0,		0],
			[new Image(),	'13b.png', 		13,		3, 		39,		0,		0,		0],
			[new Image(),	'1c.png', 		1,		4, 		40,		0,		0,		0],
			[new Image(),	'2c.png', 		2,		4, 		41,		0,		0,		0],
			[new Image(),	'3c.png', 		3,		4, 		42,		0,		0,		0],
			[new Image(),	'4c.png', 		4,		4, 		43,		0,		0,		0],
			[new Image(),	'5c.png', 		5,		4, 		44,		0,		0,		0],
			[new Image(),	'6c.png', 		6,		4, 		45,		0,		0,		0],
			[new Image(),	'7c.png', 		7,		4, 		46,		0,		0,		0],
			[new Image(),	'8c.png', 		8,		4, 		47,		0,		0,		0],
			[new Image(),	'9c.png', 		9,		4, 		48,		0,		0,		0],
			[new Image(),	'10c.png', 		10,		4, 		49,		0,		0,		0],
			[new Image(),	'11c.png', 		11,		4, 		50,		0,		0,		0],
			[new Image(),	'12c.png', 		12,		4, 		51,		0,		0,		0],
			[new Image(),	'13c.png', 		13,		4, 		52,		0,		0,		0],
			// [new Image(),	'j1.png', 		14,		0, 		52,		0,		0,		0],
			// [new Image(),	'j2.png', 		15,		0, 		53,		0,		0,		0]
		];

		var $myCanvas = $('#card');

		x = 0;
		y = 0;

		shuffle(kol);

		var p1_cards = [];
		var p2_cards = [];

		var p1_i=0;
		var p2_i=0;


		//main
		kol.forEach(function(entry, i) {
			if(entry[3] == 3 || entry[3] == 4)
			{
				p1_cards[p1_i] = entry;
				if(p1_i < 4)
					p1_cards[p1_i][7] = 1;
				p1_i++;
			}
			else{
				p2_cards[p2_i] = entry;
				if(p2_i < 4)
					p2_cards[p2_i][7] = 1;
				p2_i++;
			}
		});


		function step(name, x, y, time){
			$myCanvas.animateLayer(name, {
			  x: function(layer) {
			    return x;
			  },
			  y: function(layer) {
			    return y;
			  }
			}, time, 'swing', function(){$('canvas').removeLayer(name);});
			
		}

		$myCanvas
		//rub1
		.addLayer({
		  layer: true,
		  name: 'rub1',
		  type: 'image',
		  source: 'img/kol/rub.png',
		  x: 60, y: 82,
		  // width: 200, height: 125,
		  // click: function(layer){an(layer.name, 10, 10, 100);}
		})
		//rub2
		.addLayer({
		  layer: true,
		  name: 'rub2',
		  type: 'image',
		  source: 'img/kol/rub.png',
		  x: 740, y: 518,
		  // width: 200, height: 125,
		  // click: function(layer){an(layer.name, -10, -10, 100);}
		})
		.drawLayers();

		full_x = 220;
		full_y = 82;

		var p1_cards_on_field = [];
		p1_cards_on_field[0] = p1_cards.pop();
		p1_cards_on_field[1] = p1_cards.pop();
		p1_cards_on_field[2] = p1_cards.pop();
		p1_cards_on_field[3] = p1_cards.pop();

		p1_cards_on_field.forEach(function(entry, i) {
			$myCanvas.addLayer({
				layer: true,
				name: entry[1],
				type: 'image',
				source: 'img/kol/'+entry[1],
				x: full_x, y: full_y,
				click: function(layer){step(layer.name, 330, 300, 300); p1_cards_on_field[i] = p1_cards.pop();}
			})
			.drawLayers();
			full_x += 110;
			if(i == 3)
				return;
		});


		full_x = 220;
		full_y = 518;

		var p2_cards_on_field = [];
		p2_cards_on_field[0] = p2_cards.pop();
		p2_cards_on_field[1] = p2_cards.pop();
		p2_cards_on_field[2] = p2_cards.pop();
		p2_cards_on_field[3] = p2_cards.pop();

		p2_cards_on_field.forEach(function(entry, i) {
			$myCanvas.addLayer({
				layer: true,
				name: entry[1],
				type: 'image',
				source: 'img/kol/'+entry[1],
				x: full_x, y: full_y,
				click: function(layer){step(layer.name, 330, 300, 300); p1_cards_on_field[i] = p1_cards.pop();}
			})
			.drawLayers();
			full_x += 110;
			if(i == 3)
				return;
		});

		function shuffle(array) {
			var currentIndex = array.length, temporaryValue, randomIndex;
			while (0 !== currentIndex) {
				randomIndex = Math.floor(Math.random() * currentIndex);
				currentIndex -= 1;
				temporaryValue = array[currentIndex];
				array[currentIndex] = array[randomIndex];
				array[randomIndex] = temporaryValue;
			}
			return array;
		}





    </script>
  </body>
</html>